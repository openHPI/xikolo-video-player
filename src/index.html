<!DOCTYPE html>
<html dir="ltr" lang="en-US-x-opensap">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=Edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
    />
    <title>Stencil Component Starter</title>
    <script type="module" src="build/xmf.esm.js"></script>
    <script nomodule src="build/xmf.js"></script>
    <style>
      body {
        background: #eee;
      }

      * {
        box-sizing: border-box;
      }

      h1 a,
      h2 a {
        color: inherit;
      }

      section {
        margin: 0 auto;
        background: #fff;
        max-width: 900px;
        padding: 1em;
      }

      /* Test video-player branding */
      /* xm-player {
        --vps-slider-color: #cc0000;
        --vps-gutter-color: #cc0000;
        --vps-bg-color: #660000;
        --vps-bg-color-rgb: 255, 0, 0;
        --vps-main-color: #660000;
        --vps-menu-color-rgb: 255, 50, 50;
      } */
    </style>
  </head>
  <body>
    <section>
      <h1><a href="#">Video Player Test</a></h1>

      <div id="wrapper">
        <h2>Dual Stream openSAP VTT file</h2>
        <xm-player>
          <xm-vimeo name="lecturer" src="647310940"></xm-vimeo>
          <xm-vimeo name="slides" src="647310886"></xm-vimeo>
          <xm-text-track
            language="en"
            src="/static/en-openSAP.vtt"
            label="English openSAP"
          ></xm-text-track>
          <xm-presentation
            reference="lecturer,slides"
            name="dual"
            label="Lecturer and slides (side-by-side)"
          ></xm-presentation>
        </xm-player>

        <h2><a href="#">Dual Stream with TextTrack</a></h2>

        <xm-player
          volume="0.5"
          lang="de"
          playbackrate="2"
          showsubtitle="true"
          class="check-cue-events"
        >
          <xm-vimeo name="lecturer" src="264584278"></xm-vimeo>
          <xm-vimeo name="slides" src="340196788"></xm-vimeo>
          <xm-text-track
            language="de"
            src="/static/de.vtt"
            label="Deutsch"
          ></xm-text-track>
          <xm-text-track
            language="en"
            src="/static/en.vtt"
            label="English"
            default
          ></xm-text-track>
          <xm-presentation
            reference="lecturer,slides"
            name="dual"
            label="Lecturer and slides (side-by-side)"
          ></xm-presentation>
        </xm-player>

        <h2><a href="#">Single Stream</a></h2>

        <xm-player volume="0">
          <xm-vimeo name="primary" src="264584278"></xm-vimeo>
          <xm-text-track
            language="de"
            src="/static/de.vtt"
            label="Deutsch"
          ></xm-text-track>
          <xm-text-track
            language="en"
            src="/static/en.vtt"
            label="English"
          ></xm-text-track>
          <xm-presentation
            reference="primary"
            name="single"
            label="Single stream"
          ></xm-presentation>
        </xm-player>

        <h2>Various presentation modes</h2>

        <xm-player>
          <xm-vimeo name="lecturer" src="199649621"></xm-vimeo>
          <xm-vimeo name="slides" src="199649484"></xm-vimeo>
          <xm-vimeo name="pip" src="199649621"></xm-vimeo>
          <xm-presentation
            reference="lecturer,slides"
            name="dual"
            label="Lecturer and slides (side-by-side)"
          ></xm-presentation>
          <xm-presentation
            reference="slides"
            name="single"
            label="Slides only"
          ></xm-presentation>
          <xm-presentation
            reference="pip"
            name="pip"
            label="Lecturer and slides (picture-in-picture)"
          ></xm-presentation>
        </xm-player>

        <h2><a href="#">Toggle control</a></h2>

        <xm-player id="player-with-custom-control">
          <xm-toggle-control
            slot="toggleControl"
            name="toggleControl"
            title="Custom Control"
            active
          >
            <svg
              slot="icon"
              viewBox="0 0 32 32"
              role="presentation"
              focusable="false"
            >
              <path
                d="M0 2h32v4h-32zM0 8h20v4h-20zM0 20h20v4h-20zM0 14h32v4h-32zM0 26h32v4h-32z"
              ></path>
            </svg>
          </xm-toggle-control>
          <xm-vimeo name="pip" src="264584278"></xm-vimeo>
          <xm-presentation
            reference="pip"
            name="single"
            label="Single stream"
          ></xm-presentation>
        </xm-player>
        <div id="custom-controlled-element">
          Click the custom button to toggle the feature
        </div>

        <h2><a href="#">Interactive Transcript</a></h2>

        <xm-player id="video-player-with-transcript">
          <xm-vimeo name="pip" src="264584278"></xm-vimeo>
          <xm-text-track
            language="de"
            src="/static/de.vtt"
            label="Deutsch"
            default
          ></xm-text-track>
          <xm-text-track
            language="en"
            src="/static/en.vtt"
            label="English"
          ></xm-text-track>
          <xm-presentation
            reference="pip"
            name="single"
            label="Single stream"
          ></xm-presentation>
        </xm-player>

        <div id="transcript-text">Feed me</div>
        <br />
        <button>Button</button>

        <h2>Slide Preview</h2>
        <xm-player
          slides-src='[{"thumbnail": "https://picsum.photos/360/200/?random=1", "startPosition":10},
        { "thumbnail":"https://picsum.photos/360/200/?random=2", "startPosition":50},
        { "thumbnail":"https://picsum.photos/360/200/?random=3", "startPosition":100},
        { "thumbnail":"https://picsum.photos/360/200/?random=4", "startPosition":200}]'
        >
          <xm-vimeo name="lecturer" src="647310940"></xm-vimeo>
          <xm-vimeo name="slides" src="647310886"></xm-vimeo>
          <xm-presentation
            reference="lecturer,slides"
            name="dual"
            label="Lecturer and slides (side-by-side)"
          ></xm-presentation>
        </xm-player>
      </div>
    </section>
    <script>
      let el = document.querySelector('xm-player');
      const log = function (e) {
        console.debug(e.type, e.detail);
      };

      el.addEventListener('play', log);
      el.addEventListener('pause', log);
      el.addEventListener('seeking', log);
      el.addEventListener('seeked', log);
      el.addEventListener('bufferstart', log);
      el.addEventListener('bufferend', log);
      el.addEventListener('ended', log);

      el.addEventListener('ioc:request', log);

      el.addEventListener('click', function (e) {
        console.debug('click', e.target);
      });

      el.addEventListener('timeupdate', log);
      el.addEventListener('progress', log);

      /*
        Test for cue events
        Events should be emitted on:

        - Initial render (notifyCueListChanged)
        - Every time the language is changed (notifyCueListChanged)
        - Every time a cue changes playing the video (notifyActiveCuesUpdated)
      */
      const cueEventTracker = document.querySelector('.check-cue-events');
      cueEventTracker.addEventListener('notifyCueListChanged', log);
      cueEventTracker.addEventListener('notifyActiveCuesUpdated', log);

      /*
        Test for toggle control
      */
      const videoPlayerWithCustomControl = document.querySelector(
        '#player-with-custom-control'
      );

      const customControlledText = document.querySelector(
        '#custom-controlled-element'
      );

      videoPlayerWithCustomControl.addEventListener(
        'control:changeToggleControlActiveState',
        (event) => {
          if (event.detail.name === 'toggleControl') {
            customControlledText.innerHTML = `The feature is ${
              event.detail.active ? ' active' : ' not active'
            }`;
          }
        }
      );

      const videoPlayerWithTranscript = document.querySelector(
        '#video-player-with-transcript'
      );
      const transcriptText = document.querySelector('#transcript-text');

      videoPlayerWithTranscript.addEventListener(
        'notifyCueListChanged',
        (event) => {
          transcriptText.innerHTML = `Build transcript with ${
            event.detail.cues ? event.detail.cues.length : 'no '
          } cues.`;
        }
      );

      videoPlayerWithTranscript.addEventListener(
        'notifyActiveCuesUpdated',
        (event) => {
          if (event.detail.cues) {
            transcriptText.innerHTML = event.detail.cues[0].text;
          }
        }
      );

      document.querySelectorAll('button').forEach(function (el) {
        el.addEventListener('click', function (e) {
          document.querySelector('xm-player').requestFullscreen();
        });
      });
    </script>
  </body>
</html>
